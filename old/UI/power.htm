<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html lang="en"> 
    <head> 
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
        <title>h.a.c.s. XS1 Gauges</title> 
        <script language="javascript" type="text/javascript" src="raphael.js"></script> 
		<script language="javascript" type="text/javascript" src="/libs/jquery.js"></script>
        <script language="javascript" type="text/javascript" src="wso2vis.ctrls.js"></script>
		
        <script type="text/javascript" charset="utf-8"> 
			var timer;
			var r;
			var currentpower;
						
			function onDataReceivedCurrentPower(series) 
			{
				powername.update(series.label);
				powervalue.update(series.data[0][1]+" Wh");
				powerusage.setValue(series.data[0][1]);
			}
			
			function globalTick() 
			{
				$.ajax(
				{
					url: "/data/sensor?name=Stromzaehler&type=pwr_consump&lastentry=true",
					method: 'GET',
					dataType: 'json',
					success: onDataReceivedCurrentPower
				});					
			};
			

			function drawLinearGauges(r, offsetX, offsetY) {

				powername = new wso2vis.ctrls.Label().text("").fontsize(20).fill("#000").stroke("#000").create(r, offsetX + 350, offsetY + 10); 
				powervalue = new wso2vis.ctrls.Label().text(" Wh") .fontsize(20).fill("#000").stroke("#000").create(r, offsetX + 350, offsetY + 70); 
				powerusage = new wso2vis.ctrls.LGauge().dialRadius(100).length(600).largeTick(250).smallTick(25).minVal(0) .maxVal(4000).create(r, offsetX + 50, offsetY + 50);
				globalTick();
				
				timer = setInterval(globalTick, 30000);
			}
			
			
			function clearAll() {
				r.clear();
				clearInterval(timer);
			}
						
			window.onload = function () {
				r = Raphael("holder", 1024, 800);
								
				drawLinearGauges(r, 0, 0);
			};
			
        </script> 
    </head> 
    <body> 
         <div id="holder" style="height:300px;float:left; position:absolute; "></div>
    </body> 
</html> 
