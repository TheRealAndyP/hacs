<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>h.a.c.s. XS1 Chart-Tool</title>
    <link href="layout.css" rel="stylesheet" type="text/css"></link>
	<link href="libs/ui-lightness/jquery-ui-1.8.16.custom.css" rel="stylesheet" type="text/css"></link>
    <!--[if IE]><script language="javascript" type="text/javascript" src="libs/excanvas.min.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="libs/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="libs/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="libs/jquery.flot.selection.js"></script>
	<script language="javascript" type="text/javascript" src="libs/jquery-ui-1.8.16.custom.min.js"></script>
 <script language="javascript">
	$(function(){

				// Datepicker
				$('#datepicker_start').datepicker({
					inline: true
				});
				
				//hover states on the static widgets
				$('#dialog_link, ul#icons li').hover(
					function() { $(this).addClass('ui-state-hover'); }, 
					function() { $(this).removeClass('ui-state-hover'); }
				);
				
			});
</script>
 <script language="javascript">
	$(function(){

				// Datepicker
				$('#datepicker_end').datepicker({
					inline: true
				});
				
				//hover states on the static widgets
				$('#dialog_link, ul#icons li').hover(
					function() { $(this).addClass('ui-state-hover'); }, 
					function() { $(this).removeClass('ui-state-hover'); }
				);
				
			});
</script>
</head>
<body>
	<button id="allTemp">All Temperatures</button>
    Temperatur:
    <select id="tempsensorchanger" name="tempsensorchanger" size="1">
      <option>keine Auswahl</option>
      <option value="Terassenraum">Terassenraum</option>
      <option value="Wohnzimmer">Wohnzimmer</option>
      <option value="Kueche">K&uuml;che</option>
      <option value="Arbeitszimmer">Arbeitszimmer</option>
      <option value="Bad_oben">Bad oben</option>
      <option value="Schlafzimmer">Schlafzimmer</option>
	  <option value="Dachboden">Dachboden</option>
	  <option value="Schuppen">Schuppen</option>
    </select>	
	<button id="allHygro">All Hygrometers</button>
    Luftfeuchtigkeit:
    <select id="hygrosensorchanger" name="hygrosensorchanger" size="1">
      <option>keine Auswahl</option>
      <option value="Terassenraum_">Abstellkammer</option>
      <option value="Wohnzimmer_">Wohnzimmer</option>
      <option value="Kueche_">K&uuml;che</option>
      <option value="Arbeitszimmer_">Arbeitszimmer</option>
      <option value="Bad_oben_">Bad oben</option>
      <option value="Schlafzimmer_">Schlafzimmer</option>
	  <option value="Dachboden_">Dachboden</option>
	  <option value="Schuppen_">Schuppen</option>
	</select>
	<button id="pwrHourlySensor">Power Hourly Consumption</button>
	<button id="pwrSensorDaily">Daily Power Consumption</button>
	<button id="pwrSensor">Power Consumption (RAW)</button>
	<button id="pwrPeak">Power Peak Consumption (RAW)</button>
    <div id="placeholder" align="center" style="width:1000px;height:600px;"></div>
	<p id="hoverdata"></p>
	<button id="alldata">all data</button>
	<button id="thishour">last 3 hours</button>
	<button id="today">today</button>
	<button id="yesterday">yesterday</button>
	<button id="currentweek">current week</button>
	<button id="currentmonth">current month</button>
	<button id="clear">Clear Graphs</button>
	<p>
	<a href="/config/index.html">XS1 Configuration</a><p>
	<a href="temperatures.htm">Temperatures Gauges</a><p>
	<a href="humidity.htm">Humidity Gauges</a><p>
<!--- Here's a little experiment to add date regions -->
<!---	Start-Date <input name="startdate" id="datepicker_start" type="text"></input>
	End-Date <input name="enddate" id="datepicker_end" type="text"></input>
	<button id="dateselected">Go!</button>-->
<script id="source" language="javascript" type="text/javascript">
$(function () {
    var options = {
		        lines: { show: true },
		        points: { show: false },
		        xaxis:  {
                			mode: "time",
                			//minTickSize: [1, "hour"],
                			//min: (new Date("2010/12/28")).getTime(),
                			//max: (new Date("2010/12/29")).getTime()
				},
		        legend: { position: 'sw' },			
            		grid: { markings: weekendAreas},
		        selection: { mode: "x" },
		};

    var data = [];
    var sortof = 1;
    var lastsortof = 1;
    var placeholder = $("#placeholder");

    // helper for returning the weekends in a period
    function weekendAreas(axes) {
        var markings = [];
        var d = new Date(axes.xaxis.min);
        // go to the first Saturday
        d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7));
        d.setUTCSeconds(0);
        d.setUTCMinutes(0);
        d.setUTCHours(0);
        var i = d.getTime();
        do {
            // when we don't set yaxis, the rectangle automatically
            // extends to infinity upwards and downwards
            markings.push({ xaxis: { from: i, to: i + 2 * 24 * 60 * 60 * 1000 } });
            i += 7 * 24 * 60 * 60 * 1000;
        } while (i < axes.xaxis.max);

        return markings;
    }

    // fetch one series, adding to what we got
	// find the URL in the link right next to us 
	//var dataurl = "/data/sensor?name=Arbeitszimmer&type=temperature";
	var dataurl = "/data/powersensor?name=Stromzaehler&type=CALCHOURLYKWH";
	
	// then fetch the data with jQuery
	function onDataReceived(series) 
	{
		if (lastsortof != sortof)
		{
			data = [];
		}
		var firstcoordinate = '(' + series.data[0][0] + ', ' + series.data[0][1] + ')';
		
		for (var i = 0; i < data.length; ++i)
			data[i][0] += 60 * 60;
		
		data.push(series);
		
		// and plot all we got
		plot = $.plot(placeholder, data, options);
		lastsortof = sortof;
	}
		
	$.ajax(
	{
		url: dataurl,
		method: 'GET',
		dataType: 'json',
		success: onDataReceived
	});
	
	$("#placeholder").bind("plotselected", function (event, ranges) {
	// do the zooming
	plot = $.plot($("#placeholder"), data,
		      $.extend(true, {}, options, {
		          xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to }
		      }));
	});

	$("#today").click(function () 
	{
		var yesterday= new Date();
		yesterday.setDate(yesterday.getDate()-1);
		var now = new Date();
		now.setTime(now.getTime()+(60*60*1000));
		
		options = {		   
			lines: { show: true },
			points: { show: false },
			legend: { position: 'sw' },
		        selection: { mode: "x" },
            		grid: { markings: weekendAreas},
			xaxis: 
			{
				mode: "time",
				//minTickSize: [1, "hour"],
				min: (yesterday).getTime(),
				max: (now).getTime()
			}
		}
		
		$.plot($("#placeholder"), data, options);
	});		

	$("#thishour").click(function () 
	{
		var before= new Date();
		before.setHours(before.getHours()-3);
		var now = new Date();
		now.setTime(now.getTime()+(60*60*1000));

		options = {		   
			lines: { show: true },
			points: { show: false },
			legend: { position: 'sw' },
		        selection: { mode: "x" },
            		grid: { markings: weekendAreas},
			xaxis: 
			{
				mode: "time",
				//minTickSize: [1, "hour"],
				min: (before).getTime(),
				max: (now).getTime()
			}
		}
		
		$.plot($("#placeholder"), data, options);
	});		
	
	$("#yesterday").click(function () 
	{
		var yesterday= new Date();
		yesterday.setDate(yesterday.getDate()-1);
		yesterday.setTime(yesterday.getTime()+(60*60*1000));

		var yesteryesterday= new Date();
		yesteryesterday.setDate(yesteryesterday.getDate()-2);


		options = {		    
			lines: { show: true },
			points: { show: false },
			legend: { position: 'sw' },
	                selection: { mode: "x" },
            		grid: { markings: weekendAreas},
			xaxis: 
			{
				mode: "time",
				//minTickSize: [1, "hour"],
				min: (yesteryesterday).getTime(),
				max: (yesterday).getTime()
			}
		}
		
		$.plot($("#placeholder"), data, options);
	});		
	
	$("#currentweek").click(function () 
	{
		var startofweek= new Date();
		startofweek.setDate(startofweek.getDate()-7);
		var now = new Date();
		now.setTime(now.getTime()+(60*60*1000));

		options = {		    
			lines: { show: true },
			points: { show: false },
			legend: { position: 'sw' },
	                selection: { mode: "x" },
            		grid: { markings: weekendAreas},
			xaxis: 
			{
				mode: "time",
				//minTickSize: [1, "day"],
				min: (startofweek).getTime(),
				max: (now).getTime()
			}
		}
		
		$.plot($("#placeholder"), data, options);
	});

	$("#currentmonth").click(function () 
	{
		var startofweek= new Date();
		startofweek.setDate(startofweek.getDate()-31);
		var now = new Date();
		now.setTime(now.getTime()+(60*60*1000));


		options = {		    
			lines: { show: true },
			points: { show: false },
			legend: { position: 'sw' },
	                selection: { mode: "x" },
            		grid: { markings: weekendAreas},
			xaxis: 
			{
				mode: "time",
				//minTickSize: [1, "day"],
				min: (startofweek).getTime(),
				max: (now).getTime()
			}
		}

		
		$.plot($("#placeholder"), data, options);
	});

	$("#alldata").click(function () 
	{
			options = {		    
			lines: { show: true },
			points: { show: false },
			legend: { position: 'sw' },
	                selection: { mode: "x" },
            		grid: { markings: weekendAreas},
			xaxis: 
			{
				mode: "time",
				//minTickSize: [1, "day"],
			}
		}

		
		$.plot($("#placeholder"), data, options);
	});

	$("#tempsensorchanger").change(
		function()
		{
			sortof = 2;
			$.ajax(
			{
				url: "/data/sensor?name="+$(this).val()+"&type=temperature",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});
		});
		
	$("#hygrosensorchanger").change(
		function()
		{
			sortof = 3;
			$.ajax(
			{
				url: "/data/sensor?name="+$(this).val()+"&type=hygrometer",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});
		});

	$("#allHygro").click(
	function()
	{
		data = [];
		var selectobject=document.getElementById("hygrosensorchanger");
		for (var i=0; i<selectobject.length; i++)
		{
			sortof = 5;
			$.ajax(
			{
				url: "/data/sensor?name="+selectobject.options[i].value+"&type=hygrometer",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});
		}
	}
	);

	$("#allTemp").click(
	function()
	{
		data = [];
		var selectobject=document.getElementById("tempsensorchanger");
		for (var i=0; i<selectobject.length; i++)
		{
			sortof = 4;
			$.ajax(
			{
				url: "/data/sensor?name="+selectobject.options[i].value+"&type=temperature",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});
		}
	}
	);
	
	$("#pwrSensor").click(
	function()
	{
			sortof = 6;
			$.ajax(
			{
				url: "/data/sensor?name=Stromzaehler&type=pwr_consump",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});		
	}
	);

	$("#pwrPeak").click(
	function()
	{
			sortof = 6;
			$.ajax(
			{
				url: "/data/sensor?name=Stromzaehler_&type=pwr_peak",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});

	}
	);
	
	$("#pwrSensorDaily").click(
	function()
	{
			sortof = 6;
			$.ajax(
			{
				url: "/data/powersensor?name=Stromzaehler&type=CALCDAILYKWH",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});

	}
	);	
	
	$("#pwrHourlySensor").click(
	function()
	{
			sortof = 6;
			$.ajax(
			{
				url: "/data/powersensor?name=Stromzaehler&type=CALCHOURLYKWH",
				method: 'GET',
				dataType: 'json',
				success: onDataReceived
			});

	}
	);

	$("#clear").click(
	function()
	{
			sortof = 99;
			data = [];
			data.push([]);		
			plot = $.plot(placeholder, data, options);
	}
	);	
	
});
</script>

 </body>
</html>
